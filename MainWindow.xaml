<Window x:Class="StickyNoteMD.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Sticky Note"
        Width="300"
        Height="400"
        MinWidth="200"
        MinHeight="150"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="Manual"
        Topmost="True">

    <Window.Resources>
        <!-- Title bar button style -->
        <Style x:Key="TitleBarButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#1A1A1A"/>
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderThickness="0">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#40000000"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Close button style -->
        <Style x:Key="CloseButton" TargetType="Button" BasedOn="{StaticResource TitleBarButton}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E81123"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Toolbar button style -->
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#5A5A5A"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderThickness="0"
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#20000000"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border CornerRadius="3" Background="#FFFFFF" BorderBrush="#E0E0E0" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" Background="#B3E5FC" CornerRadius="3,3,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Add button -->
                    <Button Grid.Column="0" Style="{StaticResource TitleBarButton}"
                            Content="+" FontSize="20" FontWeight="Light"
                            Click="AddNote_Click" ToolTip="New Note"/>

                    <!-- Right buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Style="{StaticResource TitleBarButton}"
                                Click="ColorPalette_Click" ToolTip="Color">
                            <Canvas Width="16" Height="16">
                                <Ellipse Canvas.Left="2" Canvas.Top="2" Width="12" Height="12"
                                         Stroke="#1A1A1A" StrokeThickness="1.2" Fill="Transparent"/>
                                <Ellipse Canvas.Left="4" Canvas.Top="3" Width="3" Height="3" Fill="#FFF59D"/>
                                <Ellipse Canvas.Left="9" Canvas.Top="3" Width="3" Height="3" Fill="#C8E6C9"/>
                                <Ellipse Canvas.Left="3" Canvas.Top="7" Width="3" Height="3" Fill="#F8BBD0"/>
                                <Ellipse Canvas.Left="7" Canvas.Top="7" Width="3" Height="3" Fill="#B3E5FC"/>
                                <Ellipse Canvas.Left="10" Canvas.Top="7" Width="3" Height="3" Fill="#E1BEE7"/>
                            </Canvas>
                        </Button>
                        <Button x:Name="PinButton" Style="{StaticResource TitleBarButton}"
                                Click="Pin_Click" ToolTip="Pin on Top">
                            <Canvas Width="16" Height="16">
                                <Ellipse x:Name="PinHead" Canvas.Left="4" Canvas.Top="1" Width="8" Height="8"
                                         Stroke="#1A1A1A" StrokeThickness="1.2" Fill="Transparent"/>
                                <Line X1="8" Y1="9" X2="8" Y2="15"
                                      Stroke="#1A1A1A" StrokeThickness="1.5"/>
                            </Canvas>
                        </Button>
                        <Button x:Name="PreviewButton" Style="{StaticResource TitleBarButton}"
                                Click="Preview_Click" ToolTip="Preview (Ctrl+P)">
                            <Canvas Width="16" Height="16">
                                <Path Data="M8,3 C4,3 1,8 1,8 C1,8 4,13 8,13 C12,13 15,8 15,8 C15,8 12,3 8,3 Z"
                                      Stroke="#1A1A1A" StrokeThickness="1.2" Fill="Transparent"/>
                                <Ellipse Canvas.Left="5.5" Canvas.Top="5.5" Width="5" Height="5"
                                         Stroke="#1A1A1A" StrokeThickness="1.2"/>
                                <Ellipse Canvas.Left="7" Canvas.Top="7" Width="2" Height="2" Fill="#1A1A1A"/>
                            </Canvas>
                        </Button>
                        <Button Style="{StaticResource TitleBarButton}"
                                Click="Menu_Click" ToolTip="Menu">
                            <TextBlock Text="···" FontSize="16" FontWeight="Bold"
                                       Margin="0,-4,0,0"/>
                        </Button>
                        <Button Style="{StaticResource CloseButton}"
                                Content="×" FontSize="18"
                                Click="Close_Click" ToolTip="Close"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Row="1">
                <!-- Edit Mode -->
                <RichTextBox x:Name="NoteRichTextBox"
                             Background="#E1F5FE"
                             BorderThickness="0"
                             Padding="12,8"
                             FontSize="14"
                             FontFamily="Segoe UI"
                             AcceptsReturn="True"
                             AcceptsTab="True"
                             VerticalScrollBarVisibility="Auto"
                             TextChanged="NoteRichTextBox_TextChanged"
                             GotFocus="NoteRichTextBox_GotFocus"
                             LostFocus="NoteRichTextBox_LostFocus">
                    <FlowDocument LineHeight="20" PagePadding="0">
                        <FlowDocument.Resources>
                            <Style TargetType="Paragraph">
                                <Setter Property="Margin" Value="0"/>
                            </Style>
                        </FlowDocument.Resources>
                        <Paragraph/>
                    </FlowDocument>
                </RichTextBox>

                <!-- Preview Mode (Markdown rendered) -->
                <wv2:WebView2 x:Name="MarkdownPreview"
                              Visibility="Collapsed"
                              DefaultBackgroundColor="White"/>
            </Grid>

            <!-- Toolbar -->
            <Border x:Name="ToolbarBorder" Grid.Row="2" Background="#E1F5FE" Visibility="Collapsed" Height="36">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center"
                                HorizontalAlignment="Left" Margin="4,0">
                        <Button Style="{StaticResource ToolbarButton}"
                                Content="B" FontWeight="Bold"
                                Click="Bold_Click" ToolTip="Bold (Ctrl+B)"/>
                        <Button Style="{StaticResource ToolbarButton}"
                                Content="I" FontStyle="Italic"
                                Click="Italic_Click" ToolTip="Italic (Ctrl+I)"/>
                        <Button Style="{StaticResource ToolbarButton}"
                                Click="Underline_Click" ToolTip="Underline (Ctrl+U)">
                            <TextBlock Text="U" TextDecorations="Underline"/>
                        </Button>
                        <Button Style="{StaticResource ToolbarButton}"
                                Click="Strikethrough_Click" ToolTip="Strikethrough">
                            <TextBlock Text="ab" TextDecorations="Strikethrough"
                                       FontSize="12"/>
                        </Button>
                        <Button Style="{StaticResource ToolbarButton}"
                                Click="List_Click" ToolTip="Bullet List">
                            <Canvas Width="16" Height="16">
                                <Ellipse Canvas.Left="1" Canvas.Top="2" Width="3" Height="3" Fill="#5A5A5A"/>
                                <Ellipse Canvas.Left="1" Canvas.Top="7" Width="3" Height="3" Fill="#5A5A5A"/>
                                <Ellipse Canvas.Left="1" Canvas.Top="12" Width="3" Height="3" Fill="#5A5A5A"/>
                                <Rectangle Canvas.Left="6" Canvas.Top="2" Width="9" Height="2" Fill="#5A5A5A"/>
                                <Rectangle Canvas.Left="6" Canvas.Top="7" Width="9" Height="2" Fill="#5A5A5A"/>
                                <Rectangle Canvas.Left="6" Canvas.Top="12" Width="9" Height="2" Fill="#5A5A5A"/>
                            </Canvas>
                        </Button>
                        <Button Style="{StaticResource ToolbarButton}"
                                Click="Image_Click" ToolTip="Image">
                            <Canvas Width="16" Height="16">
                                <Rectangle Canvas.Left="1" Canvas.Top="2" Width="14" Height="12"
                                           Stroke="#5A5A5A" StrokeThickness="1.5" RadiusX="1" RadiusY="1"/>
                                <Ellipse Canvas.Left="3" Canvas.Top="4" Width="3" Height="3" Fill="#5A5A5A"/>
                                <Polyline Points="1,12 5,8 8,11 11,7 15,12"
                                          Stroke="#5A5A5A" StrokeThickness="1.5"/>
                            </Canvas>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
